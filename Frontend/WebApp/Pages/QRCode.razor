@page "/Scan"

<PageTitle>QR-Code Scanner</PageTitle>

<MudContainer Fixed="true" Class="camera-container">
    <MudPaper Class="camera-view">
        <div>
            <video id="videoElement" autoplay></video>
            <button @onclick="StartScanner">Start Scanner</button>
            <button @onclick="CaptureFrame">QR Code Scannen</button>
            <p>Ergebnis: @qrCodeResult</p>
        </div>
    </MudPaper>
</MudContainer>

@code {
    private string qrCodeResult;

    // Wird aufgerufen, um die Kamera zu starten
    private async Task StartScanner()
    {
        await JS.InvokeVoidAsync("startCamera");
    }

    // Wird aufgerufen, um ein Bild vom Video zu erfassen und den QR-Code zu scannen
    private async Task CaptureFrame()
    {
        var imageData = await JS.InvokeAsync<string>("captureFrame");
        if (!string.IsNullOrEmpty(imageData))
        {
            // Decodiere das Bild
            var barcodeReader = new ZXing.BarcodeReader();
            var result = barcodeReader.Decode(Convert.FromBase64String(imageData));
            qrCodeResult = result?.Text ?? "Kein QR Code gefunden";
        }
    }
}